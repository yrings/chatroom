# 多线程的小案例

> 需求：利用多线程模拟两人的直接发送消息

## 思路

创建用户类让它实现多线程接口，在主方法中创建两个用户类对象并给他们进行编号，根据编号执行不同的方法，两个方法相互唤醒和等待，以此来实现两个线程交替打印内容。

## 用户类的创建

* 创建Users类，然后创建name和userID两个成员变量，实现get、set方法和全参构造。

  ![](https://i.postimg.cc/j2PdfYHT/2022-10-11-145107.png)

  **name的作用是接收用户名，userID是标记两个用户的编号以便后面判断实现不同的方法。**

## 用户类实现多线程

* 让Users实现`Runnable`接口，然后重写`run()`方法，这里先是对userID进行判断，后面使用不同的方法。这里我用了0,1两个编号，进行预设好的内容打印。

* 在主方法内创建两个用户，创建线程对象，开启线程。

  ![](https://i.postimg.cc/W3RncR3s/2022-10-11-194448.png)

  ![](https://i.postimg.cc/jdsrYmw6/2022-10-11-194725.png)

  ![](https://i.postimg.cc/8zdG8Gwb/2022-10-11-195154.png)

## 创建打印类

* 创建`ArrayList<String>`集合，用来存储要打印的内容,并在空参构造里面添加数据，当Print类创建的时候会将预设好的内容添加到集合。

![](https://i.postimg.cc/QMSTSRT6/2022-10-11-194954.png)

* 创建两个成员方法，`printA`和`printB，`编号为1的执行A方法，编号为2的执行B方法。



## 利用等待唤醒机制

* 将方法中的代码写在同步代码块中，作用是使两个方法不能同时进行。
* 在print类中创建一个Object静态属性作为同步代码块的锁对象，创建一个静态属性flag,用来判断线程的状态，创建一个静态属性index，作为索引来遍历集合。

![](https://i.postimg.cc/T2QRkgC3/2022-10-11-195933.png)

**注意：这里三个属性都要是静态的原因是为了保证两个线程调用的属性都是同一个，实现数据共通**

**obj要为同一个的原因：obj是同步锁对象，只有同步代码块的锁对象相同时，才能实现唤醒**

* 写入while循环利用flag来判断线程状态。当`flag = false`时，B会进入循环进行等待并释放锁对象，A不会进入，然后执行下面的`obj.notify`唤醒B并将`flag = true`；当`flag = true`时，与之相反。

![](https://i.postimg.cc/28Rnjpnt/2022-10-11-200106.png)

![](https://i.postimg.cc/FzjdkR0B/2022-10-11-200123.png)

* 利用索引对集合进行遍历，由于当索引超过集合范围时，会发生空指针异常，所以在最后要对集合判断是否已经读取到最后一个数据。

![](https://i.postimg.cc/ncFSVQ4g/2022-10-11-200356.png)

* 最后在Uers类中的`run()`方法中进行循环和调用Print的方法。

![](https://i.postimg.cc/mZKMnJbm/2022-10-11-200659.png)